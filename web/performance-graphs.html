<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alaya-Vijñāna v5.0 — パフォーマンス & ケイパビリティ</title>
  <meta name="description" content="LMM システム分析 — コードベース構造・ケイパビリティ・エージェント機能グラフ" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>☸</text></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@400;700&family=IBM+Plex+Sans:wght@300;400;500;600&family=IBM+Plex+Mono:wght@300;400&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --love: #ff6b9d; --logic: #64d8ff; --fear: #ffa040; --creation: #c084fc;
      --descent: #00ffc8; --loss: #ff3366;
      --adaptive: #00ffc8; --theoretical: #64d8ff; --hyper: #c084fc;
      --active: #ffa040; --alaya: #ff6b9d; --sleep: #4a6fa5;
      --embodied: #88cc88; --pineal: #ff3366;
      --bg-deep: #030408; --bg-mid: #060a14;
      --text-primary: rgba(255,255,255,0.85); --text-secondary: rgba(255,255,255,0.45);
      --text-muted: rgba(255,255,255,0.18); --border: rgba(255,255,255,0.05);
      --serif: 'Zen Old Mincho', 'Georgia', serif;
      --sans: 'IBM Plex Sans', -apple-system, sans-serif;
      --mono: 'IBM Plex Mono', 'Menlo', monospace;
    }
    html { scroll-behavior: smooth; }
    body {
      background: var(--bg-deep); color: var(--text-primary);
      font-family: var(--sans); line-height: 1.6;
      overflow-x: hidden; -webkit-font-smoothing: antialiased;
    }
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 2px; }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes breathe { 0%, 100% { opacity: 0.15; } 50% { opacity: 0.5; } }
    @keyframes chartReveal { from { opacity: 0; transform: scaleY(0.92); } to { opacity: 1; transform: scaleY(1); } }

    .fade-in-up { animation: fadeInUp 0.8s ease both; }
    .delay-1{animation-delay:.1s} .delay-2{animation-delay:.2s} .delay-3{animation-delay:.3s} .delay-4{animation-delay:.4s}

    .ambient {
      position: fixed; inset: 0; pointer-events: none; z-index: 0;
      background:
        radial-gradient(ellipse at 15% 15%, rgba(0,255,200,0.015) 0%, transparent 50%),
        radial-gradient(ellipse at 85% 75%, rgba(100,216,255,0.02) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(255,107,157,0.01) 0%, transparent 60%);
    }

    .container { max-width: 900px; margin: 0 auto; padding: 0 20px 60px; position: relative; z-index: 1; }

    /* Header */
    .page-header {
      padding: 48px 0 32px; text-align: center;
    }
    .header-label {
      font-family: var(--mono); font-size: 9px; letter-spacing: 4px;
      color: var(--descent); opacity: 0.5; text-transform: uppercase; margin-bottom: 12px;
    }
    .header-title {
      font-family: var(--serif); font-size: 28px; font-weight: 400;
      color: var(--text-primary); margin-bottom: 6px;
    }
    .header-sub {
      font-family: var(--mono); font-size: 11px; color: var(--text-muted); margin-bottom: 32px;
    }

    /* Hero stats */
    .hero-stats {
      display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 8px;
    }
    .hero-stat {
      background: rgba(255,255,255,0.025); border: 1px solid var(--border);
      border-radius: 8px; padding: 12px 20px; text-align: center; min-width: 120px;
    }
    .hero-stat-value {
      font-family: var(--mono); font-size: 22px; font-weight: 400; display: block; margin-bottom: 2px;
    }
    .hero-stat-label {
      font-family: var(--mono); font-size: 9px; letter-spacing: 1px;
      color: var(--text-muted); text-transform: uppercase;
    }

    /* Cards */
    .section { margin-bottom: 28px; }
    .card {
      background: rgba(255,255,255,0.012); border: 1px solid var(--border);
      border-radius: 12px; padding: 24px; transition: border-color 0.4s ease;
    }
    .card:hover { border-color: rgba(255,255,255,0.08); }

    /* Section headers */
    .section-header { margin-bottom: 20px; }
    .section-label {
      font-family: var(--mono); font-size: 9px; letter-spacing: 3px;
      color: var(--descent); opacity: 0.35; text-transform: uppercase; display: block; margin-bottom: 4px;
    }
    .section-title {
      font-family: var(--serif); font-size: 17px; font-weight: 400;
      color: var(--text-primary); margin-bottom: 3px;
    }
    .section-desc {
      font-family: var(--mono); font-size: 10px; color: var(--text-muted);
    }

    /* Chart wrappers */
    .chart-wrap { position: relative; }
    .chart-wrap canvas { max-width: 100%; }

    /* Two-column performance grid */
    .perf-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;
    }
    .perf-sub-card {
      background: rgba(0,0,0,0.2); border: 1px solid var(--border);
      border-radius: 8px; padding: 16px;
    }
    .perf-sub-label {
      font-family: var(--mono); font-size: 9px; color: var(--text-muted);
      letter-spacing: 2px; text-transform: uppercase; margin-bottom: 12px;
    }
    .doughnut-wrap { position: relative; max-width: 280px; margin: 0 auto; }
    .doughnut-center {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      text-align: center; pointer-events: none;
    }
    .doughnut-center-value {
      font-family: var(--mono); font-size: 26px; color: var(--descent); display: block; line-height: 1;
    }
    .doughnut-center-sub {
      font-family: var(--mono); font-size: 8px; color: var(--text-muted);
      letter-spacing: 1px; text-transform: uppercase; display: block; margin-top: 4px;
    }

    /* Radar center card */
    .radar-wrap { max-width: 520px; margin: 0 auto; }

    /* Footer */
    .page-footer {
      text-align: center; padding: 24px 0 8px;
      font-family: var(--mono); font-size: 10px; color: var(--text-muted);
      border-top: 1px solid var(--border);
    }
    .page-footer a { color: var(--descent); text-decoration: none; opacity: 0.6; }
    .page-footer a:hover { opacity: 1; }

    /* Reveal animation class (added by IntersectionObserver) */
    .chart-revealed { animation: chartReveal 0.9s ease both; }

    @media (max-width: 600px) {
      .header-title { font-size: 20px; }
      .hero-stats { gap: 8px; }
      .hero-stat { min-width: 90px; padding: 10px 14px; }
      .hero-stat-value { font-size: 18px; }
      .perf-grid { grid-template-columns: 1fr; }
      .card { padding: 16px; }
    }
  </style>
</head>
<body>

<div class="ambient"></div>

<div class="container">

  <!-- Header -->
  <header class="page-header fade-in-up">
    <div class="header-label">SYSTEM ANALYSIS</div>
    <h1 class="header-title">パフォーマンス & ケイパビリティ</h1>
    <div class="header-sub">Alaya-Vijñāna v5.0 — LMM Codebase Intelligence Dashboard</div>

    <div class="hero-stats">
      <div class="hero-stat fade-in-up delay-1">
        <span class="hero-stat-value" style="color:var(--descent)">2.6x</span>
        <span class="hero-stat-label">高速化率</span>
      </div>
      <div class="hero-stat fade-in-up delay-2">
        <span class="hero-stat-value" style="color:var(--theoretical)">8</span>
        <span class="hero-stat-label">推論モード</span>
      </div>
      <div class="hero-stat fade-in-up delay-3">
        <span class="hero-stat-value" style="color:var(--creation)">8</span>
        <span class="hero-stat-label">エネルギー項</span>
      </div>
      <div class="hero-stat fade-in-up delay-4">
        <span class="hero-stat-value" style="color:var(--active)">37</span>
        <span class="hero-stat-label">テストファイル</span>
      </div>
    </div>
  </header>

  <!-- Chart 1: Codebase Structure -->
  <section class="section">
    <div class="card">
      <div class="section-header">
        <span class="section-label">CODEBASE STRUCTURE</span>
        <h2 class="section-title">コードベース構造 — モジュール別行数</h2>
        <span class="section-desc">Lines of code per module, grouped by subsystem</span>
      </div>
      <div class="chart-wrap" data-chart-id="chart1">
        <canvas id="chart1" height="580"></canvas>
      </div>
    </div>
  </section>

  <!-- Chart 2: System Capabilities Radar -->
  <section class="section">
    <div class="card">
      <div class="section-header">
        <span class="section-label">CAPABILITY ANALYSIS</span>
        <h2 class="section-title">システムケイパビリティ — 8次元分析</h2>
        <span class="section-desc">Relative capability scores across key dimensions (0–10)</span>
      </div>
      <div class="chart-wrap radar-wrap" data-chart-id="chart2">
        <canvas id="chart2" height="340"></canvas>
      </div>
    </div>
  </section>

  <!-- Chart 3: FEP Reasoning Modes Polar Area -->
  <section class="section">
    <div class="card">
      <div class="section-header">
        <span class="section-label">AGENT FUNCTIONS</span>
        <h2 class="section-title">FEP 推論モード — 8モード特性マップ</h2>
        <span class="section-desc">Relative reach and complexity-suitability of each FEP reasoning mode</span>
      </div>
      <div class="chart-wrap" style="max-width:580px;margin:0 auto" data-chart-id="chart3">
        <canvas id="chart3" height="340"></canvas>
      </div>
    </div>
  </section>

  <!-- Chart 4: Performance Metrics (2-column) -->
  <section class="section">
    <div class="card">
      <div class="section-header">
        <span class="section-label">PERFORMANCE METRICS</span>
        <h2 class="section-title">パフォーマンス指標 — ソルバー比較 & スケールパイプライン</h2>
        <span class="section-desc">Solver speed/quality trade-offs and multi-level cascade pipeline breakdown</span>
      </div>
      <div class="perf-grid">
        <div class="perf-sub-card">
          <div class="perf-sub-label">ソルバー比較 / Solver Comparison</div>
          <div class="chart-wrap" data-chart-id="chart4a">
            <canvas id="chart4a" height="220"></canvas>
          </div>
        </div>
        <div class="perf-sub-card">
          <div class="perf-sub-label">スケールパイプライン / Scale Pipeline</div>
          <div class="doughnut-wrap" data-chart-id="chart4b">
            <canvas id="chart4b" height="220"></canvas>
            <div class="doughnut-center">
              <span class="doughnut-center-value">2.6x</span>
              <span class="doughnut-center-sub">スパース化<br>高速化</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Chart 5: Energy Terms -->
  <section class="section">
    <div class="card">
      <div class="section-header">
        <span class="section-label">DHARMA ENERGY TERMS</span>
        <h2 class="section-title">仏教エネルギー項 — 数学的特性マッピング</h2>
        <span class="section-desc">All 8 energy terms classified by mathematical property with default weights</span>
      </div>
      <div class="chart-wrap" data-chart-id="chart5">
        <canvas id="chart5" height="320"></canvas>
      </div>
    </div>
  </section>

  <footer class="page-footer">
    <p>LMM — Surprise-based Top-K Selection via QUBO &nbsp;|&nbsp;
    <a href="https://github.com/nene3369/LMM" target="_blank">github.com/nene3369/LMM</a>
    &nbsp;|&nbsp; MIT License</p>
  </footer>

</div>

<script>
// ── Global Chart.js Defaults ─────────────────────────────────────────────────
Chart.defaults.color = 'rgba(255,255,255,0.45)';
Chart.defaults.borderColor = 'rgba(255,255,255,0.04)';
Chart.defaults.font.family = "'IBM Plex Sans', -apple-system, sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.plugins.legend.labels.usePointStyle = true;
Chart.defaults.plugins.legend.labels.padding = 16;
Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(6,10,20,0.94)';
Chart.defaults.plugins.tooltip.borderColor = 'rgba(255,255,255,0.08)';
Chart.defaults.plugins.tooltip.borderWidth = 1;
Chart.defaults.plugins.tooltip.padding = 10;
Chart.defaults.plugins.tooltip.titleFont = { family: "'IBM Plex Mono'" };
Chart.defaults.plugins.tooltip.bodyFont  = { family: "'IBM Plex Mono'" };

// ── Color Palette ─────────────────────────────────────────────────────────────
const C = {
  adaptive:    '#00ffc8',
  theoretical: '#64d8ff',
  hyper:       '#c084fc',
  active:      '#ffa040',
  alaya:       '#ff6b9d',
  sleep:       '#4a6fa5',
  embodied:    '#88cc88',
  pineal:      '#ff3366',
};
const alpha = (hex, a) => hex + Math.round(a*255).toString(16).padStart(2,'0');

// ── Chart 1: Codebase Structure (Horizontal Bar) ──────────────────────────────
(function() {
  const coreFiles = [
    { f: 'lmm/solvers.py',      n: 460 },
    { f: 'lmm/processor.py',    n: 161 },
    { f: 'lmm/selector.py',     n: 147 },
    { f: 'lmm/qubo.py',         n: 146 },
    { f: 'lmm/surprise.py',     n: 115 },
    { f: 'lmm/core.py',         n: 129 },
    { f: 'lmm/pipeline.py',     n: 80  },
  ];
  const dharmaFiles = [
    { f: 'dharma/topology.py',     n: 901 },
    { f: 'dharma/fep.py',          n: 556 },
    { f: 'dharma/algorithms.py',   n: 379 },
    { f: 'dharma/engine.py',       n: 373 },
    { f: 'dharma/neuromorphic.py', n: 350 },
    { f: 'dharma/reranker.py',     n: 340 },
    { f: 'dharma/sangha.py',       n: 339 },
    { f: 'dharma/api.py',          n: 326 },
    { f: 'dharma/energy.py',       n: 315 },
    { f: 'dharma/topology_ast.py', n: 298 },
  ];
  const reasoningFiles = [
    { f: 'reasoning/heartbeat.py',     n: 374 },
    { f: 'reasoning/orchestrator.py',  n: 350 },
    { f: 'reasoning/recovery.py',      n: 307 },
    { f: 'reasoning/alaya.py',         n: 232 },
    { f: 'reasoning/active.py',        n: 189 },
    { f: 'reasoning/context_bridge.py',n: 146 },
    { f: 'reasoning/hyper.py',         n: 140 },
    { f: 'reasoning/pineal.py',        n: 125 },
    { f: 'reasoning/theoretical.py',   n: 115 },
    { f: 'reasoning/embodiment.py',    n: 116 },
  ];
  const scaleFiles = [
    { f: 'scale/sketch.py',   n: 412 },
    { f: 'scale/stream.py',   n: 226 },
    { f: 'scale/cascade.py',  n: 136 },
    { f: 'scale/pipeline.py', n: 113 },
  ];

  // Build a unified sorted label list and per-group datasets
  const allFiles = [
    ...coreFiles.map(x=>({...x,g:'Core'})),
    ...dharmaFiles.map(x=>({...x,g:'Dharma'})),
    ...reasoningFiles.map(x=>({...x,g:'Reasoning'})),
    ...scaleFiles.map(x=>({...x,g:'Scale'})),
  ].sort((a,b)=>b.n-a.n);

  const labels = allFiles.map(x=>x.f);
  const makeData = (g) => allFiles.map(x=>x.g===g?x.n:null);

  const groups = [
    { label: 'Core',      color: C.theoretical, data: makeData('Core') },
    { label: 'Dharma',    color: C.hyper,       data: makeData('Dharma') },
    { label: 'Reasoning', color: C.adaptive,    data: makeData('Reasoning') },
    { label: 'Scale',     color: C.active,      data: makeData('Scale') },
  ];

  new Chart(document.getElementById('chart1'), {
    type: 'bar',
    data: {
      labels,
      datasets: groups.map(g => ({
        label: g.label,
        data: g.data,
        backgroundColor: alpha(g.color, 0.35),
        borderColor: g.color,
        borderWidth: 1,
        borderRadius: 3,
      }))
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 1200, easing: 'easeOutQuart' },
      scales: {
        x: {
          grid: { color: 'rgba(255,255,255,0.04)' },
          ticks: { font: { family: "'IBM Plex Mono'", size: 10 },
                   callback: v => v + ' L' },
        },
        y: {
          grid: { display: false },
          ticks: { font: { family: "'IBM Plex Mono'", size: 9 }, color: 'rgba(255,255,255,0.5)' },
        }
      },
      plugins: {
        legend: { position: 'top', labels: { font: { family: "'IBM Plex Mono'", size: 10 } } },
        tooltip: { callbacks: { label: ctx => ` ${ctx.raw ?? 0} lines` } }
      }
    }
  });
})();

// ── Chart 2: System Capabilities Radar ────────────────────────────────────────
(function() {
  new Chart(document.getElementById('chart2'), {
    type: 'radar',
    data: {
      labels: [
        'QUBO 最適化',
        '仏教エネルギー項',
        'FEP 推論',
        'スケール処理',
        '推論モード多様性',
        'メモリ統合',
        'ハードウェアエントロピー',
        'テストカバレッジ',
      ],
      datasets: [{
        label: 'Alaya V5',
        data: [9, 8, 8, 7, 9, 8, 7, 8],
        backgroundColor: 'rgba(0,255,200,0.07)',
        borderColor: C.adaptive,
        pointBackgroundColor: C.adaptive,
        pointBorderColor: 'transparent',
        pointRadius: 4,
        borderWidth: 1.5,
      }]
    },
    options: {
      responsive: true,
      animation: { duration: 1400, easing: 'easeOutBack' },
      scales: {
        r: {
          min: 0, max: 10,
          ticks: { stepSize: 2, display: false, backdropColor: 'transparent' },
          grid: { color: 'rgba(255,255,255,0.06)' },
          angleLines: { color: 'rgba(255,255,255,0.04)' },
          pointLabels: {
            font: { family: "'IBM Plex Mono'", size: 10 },
            color: 'rgba(255,255,255,0.55)',
            padding: 8,
          }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: { callbacks: { label: ctx => ` スコア: ${ctx.raw}/10` } }
      }
    }
  });
})();

// ── Chart 3: FEP Reasoning Modes Polar Area ───────────────────────────────────
(function() {
  const modes = [
    { label: '応病与薬\nAdaptive',  score: 85, color: C.adaptive    },
    { label: '因明\nTheoretical',   score: 75, color: C.theoretical },
    { label: '般若の飛躍\nHyper',   score: 90, color: C.hyper       },
    { label: '托鉢\nActive',        score: 70, color: C.active      },
    { label: '阿頼耶識\nAlaya',     score: 80, color: C.alaya       },
    { label: '禅定\nSleep',         score: 60, color: C.sleep       },
    { label: '六根\nEmbodiment',    score: 65, color: C.embodied    },
    { label: '松果体\nPineal',      score: 55, color: C.pineal      },
  ];
  new Chart(document.getElementById('chart3'), {
    type: 'polarArea',
    data: {
      labels: modes.map(m=>m.label),
      datasets: [{
        data: modes.map(m=>m.score),
        backgroundColor: modes.map(m=>alpha(m.color, 0.22)),
        borderColor: modes.map(m=>m.color),
        borderWidth: 1.5,
      }]
    },
    options: {
      responsive: true,
      animation: { animateRotate: true, duration: 1500, easing: 'easeOutBack' },
      scales: {
        r: {
          ticks: { display: false, backdropColor: 'transparent' },
          grid: { color: 'rgba(255,255,255,0.05)' },
        }
      },
      plugins: {
        legend: {
          position: 'right',
          labels: { font: { family: "'IBM Plex Mono'", size: 9 }, boxWidth: 10, padding: 12 }
        },
        tooltip: {
          callbacks: {
            label: ctx => ` 複雑度適合スコア: ${ctx.raw}`,
          }
        }
      }
    }
  });
})();

// ── Chart 4a: Solver Comparison (Grouped Bar) ─────────────────────────────────
(function() {
  new Chart(document.getElementById('chart4a'), {
    type: 'bar',
    data: {
      labels: ['SA\n(焼きなまし)', 'Ising-SA\n(SIMD)', 'Relaxation\n(SLSQP)', 'Greedy\n(貪欲法)'],
      datasets: [
        {
          label: '相対速度',
          data: [70, 100, 40, 95],
          backgroundColor: alpha(C.adaptive, 0.3),
          borderColor: C.adaptive,
          borderWidth: 1,
          borderRadius: 3,
        },
        {
          label: '解の品質',
          data: [85, 90, 75, 65],
          backgroundColor: alpha(C.hyper, 0.3),
          borderColor: C.hyper,
          borderWidth: 1,
          borderRadius: 3,
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 1000, easing: 'easeOutQuart' },
      scales: {
        y: {
          min: 0, max: 110,
          grid: { color: 'rgba(255,255,255,0.04)' },
          ticks: { font: { family: "'IBM Plex Mono'", size: 9 } }
        },
        x: {
          grid: { display: false },
          ticks: { font: { family: "'IBM Plex Mono'", size: 8 } }
        }
      },
      plugins: {
        legend: { position: 'top', labels: { font: { family: "'IBM Plex Mono'", size: 9 } } },
        tooltip: { callbacks: { label: ctx => ` ${ctx.dataset.label}: ${ctx.raw}` } }
      }
    }
  });
})();

// ── Chart 4b: Scale Pipeline Doughnut ─────────────────────────────────────────
(function() {
  new Chart(document.getElementById('chart4b'), {
    type: 'doughnut',
    data: {
      labels: ['Stream Filter (1T tokens)', 'Percentile Trim (×0.3)', 'QUBO Solve (top-K)'],
      datasets: [{
        data: [70, 20, 10],
        backgroundColor: [
          alpha(C.active, 0.28),
          alpha(C.theoretical, 0.28),
          alpha(C.adaptive, 0.38),
        ],
        borderColor: [C.active, C.theoretical, C.adaptive],
        borderWidth: 1.5,
        hoverOffset: 6,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '64%',
      animation: { animateRotate: true, duration: 1200, easing: 'easeOutQuart' },
      plugins: {
        legend: {
          position: 'bottom',
          labels: { font: { family: "'IBM Plex Mono'", size: 8 }, boxWidth: 8, padding: 10 }
        },
        tooltip: {
          callbacks: {
            label: ctx => ` ${ctx.label}: ${ctx.raw}%`
          }
        }
      }
    }
  });
})();

// ── Chart 5: Energy Terms Grouped Horizontal Bar ──────────────────────────────
(function() {
  const terms = [
    { name: 'Sila\n(戒・基数制約)',          w: 10.0, prop: 'Frustrated'    },
    { name: 'Dukkha\n(苦・サプライズ)',       w: 1.0,  prop: 'Linear'        },
    { name: 'Prajna\n(般若・多様性)',         w: 1.0,  prop: 'Linear'        },
    { name: 'Metta\n(慈愛・多様性ペナルティ)',w: 1.0,  prop: 'Submodular'    },
    { name: 'Karma\n(業・過去選択ペナルティ)',w: 1.0,  prop: 'Linear'        },
    { name: 'QueryDukkha\n(RAGサプライズ)',   w: 1.0,  prop: 'Linear'        },
    { name: 'Karuna\n(慈悲・相乗効果)',       w: 0.5,  prop: 'Supermodular'  },
    { name: 'Upeksha\n(平静・偏差ペナルティ)',w: 0.5,  prop: 'Linear'        },
  ];

  const propColors = {
    'Linear':       { bg: alpha(C.theoretical, 0.3), border: C.theoretical },
    'Supermodular': { bg: alpha(C.adaptive,    0.3), border: C.adaptive    },
    'Submodular':   { bg: alpha(C.alaya,       0.3), border: C.alaya       },
    'Frustrated':   { bg: alpha(C.pineal,      0.3), border: C.pineal      },
  };

  const props = ['Linear', 'Supermodular', 'Submodular', 'Frustrated'];
  const labels = terms.map(t => t.name);

  const datasets = props.map(p => ({
    label: p,
    data: terms.map(t => t.prop === p ? t.w : null),
    backgroundColor: propColors[p].bg,
    borderColor: propColors[p].border,
    borderWidth: 1,
    borderRadius: 3,
  }));

  new Chart(document.getElementById('chart5'), {
    type: 'bar',
    data: { labels, datasets },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 1100, easing: 'easeOutQuart' },
      scales: {
        x: {
          grid: { color: 'rgba(255,255,255,0.04)' },
          ticks: { font: { family: "'IBM Plex Mono'", size: 10 },
                   callback: v => 'w=' + v }
        },
        y: {
          grid: { display: false },
          ticks: { font: { family: "'IBM Plex Mono'", size: 9 }, color: 'rgba(255,255,255,0.5)' }
        }
      },
      plugins: {
        legend: {
          position: 'top',
          labels: { font: { family: "'IBM Plex Mono'", size: 10 } }
        },
        tooltip: {
          callbacks: {
            label: ctx => ` ${ctx.dataset.label} — weight: ${ctx.raw}`
          }
        }
      }
    }
  });
})();

// ── IntersectionObserver for scroll-reveal ────────────────────────────────────
(function() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('chart-revealed');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.15 });

  document.querySelectorAll('.chart-wrap').forEach(el => observer.observe(el));
})();
</script>
</body>
</html>
